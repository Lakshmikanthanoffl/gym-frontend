<!-- Summary Cards -->
<div class="dashboard-grid" *ngIf="isAdminOrSuperAdmin">
  <p-card header="Total Members"><p>{{ totalMembers }}</p></p-card>
  <p-card header="Active Members"><p>{{ activeMembers }}</p></p-card>
  <p-card header="Expired Members"><p>{{ expiredMembers }}</p></p-card>
  <p-card header="New This Month"><p>{{ newMembersThisMonth }}</p></p-card>
</div>

<!-- Graph + Admin/QR -->
<div class="mt-4" *ngIf="isAdminOrSuperAdmin">
  <div class="grid-layout">
    <!-- Member Trend Graph -->
    <p-card [header]="isSuperAdmin ? 'Members per Admin' : 'New Members Trend'" class="full-height">
      <p-chart type="bar" [data]="memberChartData" [options]="memberChartOptions"></p-chart>
    </p-card>

    <!-- SuperAdmin: Admin Subscription Expiry -->
   <!-- SuperAdmin: Admin Subscription Expiry (Modern Dark Theme) -->
   <p-card header="Admin Subscription Expiry" class="full-height shadow-lg rounded-lg p-4" *ngIf="isSuperAdmin">
    <table class="admin-expiry-table">
      <thead>
        <tr>
          <th>Admin</th>
          <th>Gym</th>
          <th>Valid Until</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let role of rolesList">
          <td>{{ role.userName }}</td>
          <td>{{ role.gymName }}</td>
          <td>{{ role.countdown }}</td>
          <td [style.color]="role.statusColor" class="font-semibold">
            {{ role.status }}
          </td>

        </tr>
        <tr *ngIf="!rolesList?.length">
          <td colspan="4" class="text-center text-gray-400 py-4">No admins found</td>
        </tr>
      </tbody>
    </table>
  </p-card>
  


    <!-- Admin: QR Payment Card instead of Expiry -->
    <p-card header="Payments" class="full-height qr-box" *ngIf="!isSuperAdmin && isAdmin">
      <div class="qr-container">
        <img 
          [src]="getUpiQrUrl(defaultGymId!, defaultGymName!)" 
          alt="QR Code" 
          class="qr-image"
        />
        <p class="mt-2 text-center font-semibold text-green-600">
          ✅ Pay to: {{ defaultGymName }}
        </p>
        <div class="upi-logos" *ngIf="userrole === 'admin'">
          <img src="assets/logos/paytm.png" alt="Paytm">
          <img src="assets/logos/phonepe.png" alt="PhonePe">
          <img src="assets/logos/gpay.png" alt="Google Pay">
        </div>
      </div>
    </p-card>
  </div>
</div>

<!-- SuperAdmin: Admin-wise Members with QR (unchanged) -->
<div class="mt-4" *ngIf="isSuperAdmin && rolesList.length">
  <p-card *ngFor="let role of rolesList" [header]="role.userName + ' (' + role.gymName + ')'">
    
    <div class="qr-container mb-3">
      <img [src]="getUpiQrUrl(role.gymId, role.gymName)" class="qr-image" alt="QR Code">
      <p class="mt-2 text-center font-semibold text-green-600">
        ✅ Pay to: {{ role.gymName }}
      </p>
    </div>

    <table class="table">
      <thead>
        <tr>
          <th>Member Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Subscription</th>
          <th>Valid Until</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let member of adminMembersMap[role.gymId]">
          <td>{{ member.Name }}</td>
          <td>{{ member.Email }}</td>
          <td>{{ member.Phone }}</td>
          <td>{{ member.SubscriptionType?.Label }} ({{ member.AmountPaid }})</td>
          <td>{{ member.ValidUntil | date:'dd-MM-yyyy' }}</td>
        </tr>
        <tr *ngIf="!adminMembersMap[role.gymId]?.length">
          <td colspan="5" class="text-center">No members</td>
        </tr>
      </tbody>
    </table>
  </p-card>
</div>
